<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Master ‚Äì Cerca dentro gli ordini</title>
  <style>
    html{height:100%; background:#000; -webkit-text-size-adjust:100%; text-size-adjust:100%;}
    body{height:100%; background:#000; margin:0; overflow-x:hidden;}
    [data-app]{
      color-scheme: dark;
      --bg:#000; --fg:#fff; --accent:#0a84ff; --border:#2c2c2e;
      --highlight:#ffd60a; --radius:22px; --elev:0 10px 24px rgba(0,0,0,.15);
      --success:#22c55e;
      font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif;
      font-size:16px; line-height:1.25;
      background:var(--bg); color:var(--fg);
    }
    .wrap{
      width:100%;
      max-width:min(920px,100%);
      margin:0 auto;
      padding:calc(10px + env(safe-area-inset-top)) 16px calc(24px + env(safe-area-inset-bottom));
      display:flex; flex-direction:column; gap:14px;
      box-sizing:border-box;
    }
    .section{
      width:100%;
      border-radius:var(--radius);
      padding:18px 16px 14px;
      background:#fff; color:#111;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:var(--elev);
      box-sizing:border-box;
    }
    .title{
      display:flex; align-items:center; justify-content:center; gap:10px;
      font-weight:900; font-size:18px; margin:0 0 12px;
      color:#111;
    }
    .hint{ margin:0 0 12px; color:#222; font-size:14px; text-align:center; }
    .search{
      display:flex; flex-direction:column; gap:10px;
      margin-top:8px;
    }
    .input{
      flex:1;
      padding:14px 14px;
      border-radius:26px;
      border:1px solid var(--border);
      font-size:16px;
      background:#fff;
      color:#111;
      outline:none;
    }
    .row2{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    .btn{
      border:none; border-radius:26px;
      padding:14px 18px;
      background:var(--accent);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      font-size:15px; line-height:1;
      transition:transform .06s ease, opacity .2s ease;
      -webkit-tap-highlight-color:transparent;
      user-select:none;
    }
    .btn:active{ transform:scale(.995); }
    .btn.secondary{ background:#111; color:#fff; }
    .btn:disabled{ opacity:.6; cursor:default; }
    @media(min-width:620px){
      .search{ flex-direction:row; align-items:center; }
      .input{ flex:1; }
    }

    .toolbar{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
      margin-top:10px;
    }
    .chip{
      border:1px solid rgba(0,0,0,.08);
      background:#f2f2f3;
      color:#111;
      border-radius:999px;
      padding:10px 12px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      min-height:40px;
    }
    .chip.active{ background:var(--highlight); color:#000; }

    .status{
      margin-top:10px;
      font-size:12px;
      color:#555;
      text-align:center;
    }
    .status .linklike{
      border:none; background:none; padding:0; margin-left:.25rem;
      color:#0a84ff; text-decoration:underline; cursor:pointer; font:inherit;
    }

    .results{ display:flex; flex-direction:column; gap:10px; margin-top:14px; }
    .order-card{
      display:flex; align-items:center; gap:12px;
      padding:12px;
      border-radius:26px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:var(--elev);
      cursor:pointer;
      box-sizing:border-box;
      transition:transform .06s ease, opacity .2s ease;
      min-height:56px;
    }
    .order-card:active{ transform:scale(.995); }
    .badge{
      min-width:52px; height:34px;
      display:inline-flex; align-items:center; justify-content:center;
      border-radius:999px;
      background:var(--highlight);
      color:#000;
      font-weight:1000;
      font-variant-numeric:tabular-nums;
    }
    .main{ flex:1; min-width:0; }
    .name{ font-weight:1000; color:#0b0b0b; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sub{ display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; align-items:center; }
    .pill{
      padding:4px 8px; border-radius:999px; font-weight:900; font-size:11px;
      background:#f2f2f3; color:#111;
    }
    .pill.zone{ background:var(--success); color:#fff; }
    .snippet{
      width:100%;
      margin-top:8px;
      font-size:13px;
      color:#222;
      background:#fafafa;
      border:1px solid #ececef;
      border-radius:14px;
      padding:8px 10px;
      line-height:1.25;
    }
    mark{
      background:rgba(255,214,10,.55);
      padding:0 .15em;
      border-radius:.25em;
      font-weight:1000;
    }

    .empty{
      padding:12px;
      border-radius:16px;
      border:1px dashed rgba(0,0,0,.15);
      background:#fff; color:#333;
      font-size:14px; text-align:center;
    }

    /* ===== Modale (stile SSO) ===== */
    .modal{ position:fixed; inset:0; display:none; z-index:2147483647; }
    .modal.open{ display:block; }
    .modal .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter:saturate(1.2) blur(6px); }
    .modal .sheet{ position:absolute; inset:0; background:#fff; color:#111; display:flex; flex-direction:column; }
    .modal header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 16px 12px;
      border-bottom:1px solid #ececec;
      position:sticky; top:0; background:#fff; z-index:1;
    }
    .modal header .h{ font-weight:1000; font-size:22px; text-align:left; margin:0; }
    .modal header .text{ font-size:14px; text-align:left; margin-top:6px; color:#555; }
    .modal .close{
      border:1px solid #ddd; background:#fff;
      border-radius:999px; padding:8px 12px; font-weight:900; cursor:pointer;
    }
    .modal .content{ padding:12px 16px 28px; overflow:auto; font-size:16px; }
    .kv{ width:100%; border-collapse:collapse; }
    .kv th,.kv td{ text-align:left; padding:12px 10px; border-bottom:1px solid #f1f1f1; font-size:16px; }
    .kv th{ width:36%; color:#444; font-weight:900; }
    .kv tr:last-child th,.kv tr:last-child td{ border-bottom:none; }
    .kv tr.hl{ background:rgba(255,214,10,.22); }
  </style>
</head>
<body>
  <div data-app>
    <div class="wrap">

      <section class="section">
        <h1 class="title">Cerca dentro gli ordini</h1>
        <p class="hint">Scrivi una parola qualsiasi (prodotto, note, telefono, ecc.). Ti ritorno gli ordini che la contengono.</p>

        <div class="search">
          <input id="q" class="input" type="search" placeholder="es. 'ravioli' ‚Ä¢ 'senza lattosio' ‚Ä¢ 'Andrea' ‚Ä¢ 'polenta'‚Ä¶" autocomplete="off" />
          <div class="row2">
            <button id="go" class="btn" type="button">Cerca</button>
            <button id="clear" class="btn secondary" type="button">Pulisci</button>
          </div>
        </div>

        <div class="toolbar" aria-label="Opzioni ricerca">
          <button class="chip active" id="mode-all" type="button" data-mode="all">Tutti i campi</button>
          <button class="chip" id="mode-notes" type="button" data-mode="notes">Solo NOTE</button>
          <button class="chip" id="mode-items" type="button" data-mode="items">Solo righe prodotto</button>
        </div>

        <div id="status" class="status"></div>
        <div id="out" class="results"></div>
      </section>

    </div>
  </div>

  <!-- Modale -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog">
    <div class="backdrop"></div>
    <div class="sheet">
      <header>
        <div style="min-width:0;">
          <div id="mTitle" class="h" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">Dettaglio ordine</div>
          <div id="mSub" class="text" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"></div>
        </div>
        <button id="mClose" class="close" aria-label="Chiudi">Chiudi</button>
      </header>
      <div class="content">
        <table class="kv" id="mTable"></table>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // Stesso endpoint gi√† usato nel progetto  [oai_citation:3‚Ä°index.html](file-service://file-YUpjDMTBwh782ZmBGWgHRx)
    const API_URL = 'https://script.google.com/macros/s/AKfycbzp_2RNQO9ROQkpcGebBpZ9P_MyZEmxkqLh5G-ODe4Yo2x9E0aRbEQIbmofaxhod9VGFA/exec';

    // ===== Utils (coerenti con SSO) =====
    const esc = (s) => String(s ?? '').replace(/[&<>"]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
    const norm = (s) => (s||'')
      .toLowerCase()
      .normalize('NFD').replace(/\p{Diacritic}/gu,'')
      .replace(/\s+/g,' ')
      .trim();

    const ymd = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const ddmmyyyy = d => `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;

    function parseAnyDate(s){
      if(!s) return null;
      const str = String(s).trim();
      let m = str.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);
      if(m){
        const dd=+m[1], mm=+m[2]-1, yy=+m[3];
        return new Date(yy<100?2000+yy:yy, mm, dd, 12,0,0);
      }
      m = str.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if(m) return new Date(+m[1], +m[2]-1, +m[3], 12,0,0);
      const d = new Date(str);
      return Number.isNaN(d.getTime()) ? null : d;
    }

    const pickKey = (obj, cands) => {
      const ks = Object.keys(obj||{});
      for(const c of cands){ const k = ks.find(x => norm(x) === norm(c)); if(k) return k; }
      for(const c of cands){ const k = ks.find(x => norm(x).includes(norm(c))); if(k) return k; }
      return null;
    };

    // ===== Mapping ordini: come SSO (robusto su colonne variabili)  [oai_citation:4‚Ä°stoccaggio.html](file-service://file-71VuAT8511m4KLpAbbadHr)
    function mapRowsFromAPI(rows){
      const out=[];
      for(const r of (rows||[])){
        if(!r || typeof r !== 'object') continue;

        const nameKey = pickKey(r,['NOME CLIENTE','NOME','CLIENTE']);
        const dateKeyRaw = pickKey(r,['DATA ORDINE','DATA','GIORNO','DATA RITIRO','RITIRO']);
        const timeKey = pickKey(r,['ORA','ORARIO']);
        const zoneKey = pickKey(r,['ZONA STOCCAGGIO','ZONA','STOCCAGGIO','UBICAZIONE']);
        const ordKey  = pickKey(r,['NUMERO ORDINE','ORDINE','N¬∞ ORDINE','ORD']);

        const name = nameKey ? String(r[nameKey]||'').trim() : '';
        if(!name) continue;

        const d = dateKeyRaw ? parseAnyDate(r[dateKeyRaw]) : null;
        const time = timeKey ? String(r[timeKey]||'').trim() : '';
        const zone = zoneKey ? String(r[zoneKey]||'').trim() : '';
        const ordRaw = ordKey ? r[ordKey] : r.ord;
        const ord = (ordRaw!=null && ordRaw!=='') ? Number(ordRaw) : null;

        out.push({
          ord: Number.isFinite(ord) ? ord : null,
          name,
          dateKey: d ? ymd(d) : null,
          dateText: d ? ddmmyyyy(d) : '',
          time,
          zone,
          src: r
        });
      }
      return out;
    }

    // ===== Search index =====
    function buildSearchBlob(row){
      // Indice completo: tutte le chiavi/valori, pi√π campi "comodi"
      const parts = [];
      parts.push(row.ord!=null ? String(row.ord) : '');
      parts.push(row.name||'');
      parts.push(row.dateText||'');
      parts.push(row.time||'');
      parts.push(row.zone||'');

      for(const [k,v] of Object.entries(row.src||{})){
        parts.push(String(k));
        if(v==null) continue;
        parts.push(typeof v === 'string' ? v : JSON.stringify(v));
      }
      return norm(parts.join(' ‚Ä¢ '));
    }

    function extractNotes(row){
      // prova a trovare NOTE / NOTE SULL'ORDINE ecc. (senza assumere header identico)
      const k = pickKey(row.src||{}, ['NOTE SULL\'ORDINE','NOTE SULL ORDINE','NOTE','ANNOTAZIONI','RICHIESTE SPECIALI','RICHIESTE','ALLERGIE']);
      return k ? String(row.src[k]||'').trim() : '';
    }

    function extractItemsText(row){
      // euristica: molte tue tabelle hanno righe "1) ...", "2) ..." ecc. (come nel modal SSO)  [oai_citation:5‚Ä°stoccaggio.html](file-service://file-71VuAT8511m4KLpAbbadHr)
      const lines=[];
      for(const [k,v] of Object.entries(row.src||{})){
        const kk = String(k||'');
        if(/^\s*\d+\)\s*/.test(kk)){
          const val = String(v??'').trim();
          if(val && val!=='0') lines.push(`${kk} ${val}`);
        }
      }
      return lines.join(' ‚Ä¢ ').trim();
    }

    function highlightSnippet(text, qNorm){
      if(!qNorm) return '';
      const raw = String(text||'');
      const n = norm(raw);
      const idx = n.indexOf(qNorm);
      if(idx < 0) return '';
      // prendo una finestra ‚Äúumana‚Äù
      const left = Math.max(0, idx - 60);
      const right = Math.min(raw.length, idx + 60);
      const slice = raw.slice(left, right);

      // highlight ‚Äúbest-effort‚Äù (senza impazzire con mapping posizioni normalize->raw)
      // evidenzio tutte le occorrenze case-insensitive sullo slice
      const re = new RegExp(qNorm.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'), 'ig');
      return esc(slice).replace(re, (m)=>`<mark>${esc(m)}</mark>`);
    }

    // ===== UI =====
    const $ = (s)=>document.querySelector(s);
    const out = $('#out');
    const status = $('#status');
    const qEl = $('#q');

    let DATA = [];
    let MODE = 'all'; // all | notes | items

    function setMode(m){
      MODE = m;
      document.querySelectorAll('.chip[data-mode]').forEach(b=>{
        b.classList.toggle('active', b.dataset.mode === m);
      });
      // rerender con query corrente
      runSearch();
    }

    $('#mode-all').addEventListener('click', ()=>setMode('all'));
    $('#mode-notes').addEventListener('click', ()=>setMode('notes'));
    $('#mode-items').addEventListener('click', ()=>setMode('items'));

    $('#go').addEventListener('click', runSearch);
    qEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') runSearch(); });

    $('#clear').addEventListener('click', ()=>{
      qEl.value = '';
      out.innerHTML = '';
      status.textContent = '';
      qEl.focus();
    });

    // ===== Modal (stile e logica ispirati a SSO)  [oai_citation:6‚Ä°stoccaggio.html](file-service://file-71VuAT8511m4KLpAbbadHr)
    const modal = $('#modal');
    const mClose = $('#mClose');
    const mTitle = $('#mTitle');
    const mSub = $('#mSub');
    const mTable = $('#mTable');

    function lockScroll(){
      const y = window.scrollY || window.pageYOffset;
      document.body.dataset.scrollY = y;
      document.body.style.position='fixed';
      document.body.style.top=`-${y}px`;
      document.body.style.left='0';
      document.body.style.right='0';
      document.body.style.width='100%';
    }
    function unlockScroll(){
      const y = +(document.body.dataset.scrollY||0);
      document.body.style.position='';
      document.body.style.top='';
      document.body.style.left='';
      document.body.style.right='';
      document.body.style.width='';
      window.scrollTo(0,y);
      delete document.body.dataset.scrollY;
    }

    function openModal(row, qNorm){
      mTitle.textContent = row.name || 'Dettaglio ordine';
      mSub.textContent = [ row.ord? `Ordine #${row.ord}`: null, row.dateText || null, row.time || null, row.zone ? `Zona: ${row.zone}` : null ].filter(Boolean).join(' ‚Ä¢ ');

      const entries = Object.entries(row.src||{});
      // salta duplicati ‚Äúdi testata‚Äù, come fai gi√† in SSO  [oai_citation:7‚Ä°stoccaggio.html](file-service://file-71VuAT8511m4KLpAbbadHr)
      const skipKeys = new Set(['ord','numero ordine (parsed)','ora (parsed)','zona (parsed)','nome','nome cliente','cliente','data','giorno','data ordine','ora','orario']
        .map(k=>norm(k)));

      let seenItemsStart=false;
      const rowsHtml = entries
        .filter(([k,_])=>!skipKeys.has(norm(String(k))))
        .map(([k,v])=>{
          const keyStr = String(k).trim();
          const valStr = (v==null)? '' : String(v).trim();

          if(/^\s*1\)\s*/i.test(keyStr)) seenItemsStart=true;

          // evidenzia righe prodotto ‚Äúnon vuote‚Äù, come nel tuo SSO  [oai_citation:8‚Ä°stoccaggio.html](file-service://file-71VuAT8511m4KLpAbbadHr)
          const shouldHL = seenItemsStart && valStr!=='' && valStr!=='0';

          // se c‚Äô√® query, evidenzia anche le righe che la contengono (extra)
          const matchHL = qNorm && (norm(keyStr+' '+valStr).includes(qNorm));

          return `<tr class="${(shouldHL||matchHL)?'hl':''}"><th>${esc(keyStr)}</th><td>${esc(valStr)}</td></tr>`;
        }).join('');

      mTable.innerHTML = rowsHtml || `<tr><td>Nessun dettaglio</td></tr>`;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      lockScroll();
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      unlockScroll();
    }
    mClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target.classList.contains('backdrop')) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('open')) closeModal(); });

    // ===== Fetch =====
    async function fetchAPI(){
      status.innerHTML = 'Carico ordini‚Ä¶';
      const res = await fetch(API_URL + '?_ts=' + Date.now(), {
        cache:'no-store',
        mode:'cors',
        headers:{Accept:'application/json, text/plain, */*'}
      });
      const raw = await res.text();
      if(!res.ok) throw new Error(`HTTP ${res.status}: ${raw.slice(0,200)}`);

      let data;
      try{
        const ct = (res.headers.get('content-type')||'').toLowerCase();
        const looksJson = ct.includes('json') || raw.trim().startsWith('{') || raw.trim().startsWith('[');
        if(looksJson) data = JSON.parse(raw);
        else throw new Error('API non JSON');
      }catch(_){
        const s = raw.search(/[\[{]/), eB = raw.lastIndexOf('}'), eA = raw.lastIndexOf(']'), e = Math.max(eB,eA);
        if(s!==-1 && e>s) data = JSON.parse(raw.slice(s,e+1));
        else throw new Error('Parse JSON fallita');
      }

      let rows=[];
      if(Array.isArray(data)) rows=data;
      else if(Array.isArray(data.rows)) rows=data.rows;
      else if(Array.isArray(data.data)) rows=data.data;
      else if(data && typeof data==='object'){
        const k = Object.keys(data).find(x=>Array.isArray(data[x]) && (data[x].length===0 || typeof data[x][0]==='object'));
        if(k) rows=data[k];
      }
      if(!Array.isArray(rows)) rows=[];

      DATA = mapRowsFromAPI(rows);
      // pre-index
      for(const r of DATA){
        r.__blobAll = buildSearchBlob(r);
        r.__notes = norm(extractNotes(r));
        r.__items = norm(extractItemsText(r));
      }
      status.innerHTML = `Ordini caricati: <b>${DATA.length}</b> ‚Ä¢ <button class="linklike" id="refreshNow" type="button">aggiorna ora</button>`;
      const btn = document.getElementById('refreshNow');
      if(btn) btn.onclick = async ()=>{
        btn.disabled=true; btn.textContent='aggiorno‚Ä¶';
        try{ await fetchAPI(); runSearch(); }
        catch(e){ status.textContent = 'Errore aggiornamento: ' + (e.message||e); }
      };
    }

    // ===== Search =====
    function runSearch(){
      const q = norm(qEl.value);
      if(!q){
        out.innerHTML = `<div class="empty">Scrivi qualcosa nella barra di ricerca ‚òùÔ∏è</div>`;
        return;
      }

      const hits = [];
      for(const r of DATA){
        let hay = r.__blobAll;
        if(MODE==='notes') hay = r.__notes;
        if(MODE==='items') hay = r.__items;

        if(hay && hay.includes(q)){
          hits.push(r);
        }
      }

      // ordina: prima quelli con match in note, poi per data (se presente), poi per numero ordine
      hits.sort((a,b)=>{
        const an = (a.__notes && a.__notes.includes(q)) ? 1 : 0;
        const bn = (b.__notes && b.__notes.includes(q)) ? 1 : 0;
        if(an!==bn) return bn-an;
        const ad = a.dateKey || '';
        const bd = b.dateKey || '';
        if(ad!==bd) return bd.localeCompare(ad);
        return (b.ord||0) - (a.ord||0);
      });

      if(hits.length===0){
        out.innerHTML = `<div class="empty">Nessun ordine contiene ‚Äú<b>${esc(qEl.value)}</b>‚Äù.</div>`;
        return;
      }

      out.innerHTML = hits.map(r=>{
        const num = r.ord!=null ? r.ord : '‚Äî';
        const pills = [
          r.dateText ? `<span class="pill">${esc(r.dateText)}</span>` : '',
          r.time ? `<span class="pill">${esc(r.time)}</span>` : '',
          r.zone ? `<span class="pill zone">${esc(r.zone)}</span>` : ''
        ].filter(Boolean).join('');

        // snippet: priorit√† NOTE, poi righe prodotto, poi blob generico
        const rawNotes = extractNotes(r);
        const rawItems = extractItemsText(r);
        const rawGeneric = (function(){
          // prendo un campo ‚Äúumano‚Äù da mostrare
          const keys = Object.keys(r.src||{});
          const k = keys.find(x=>norm(x).includes('note')) || keys.find(x=>norm(x).includes('richiest')) || keys.find(x=>norm(x).includes('allerg'));
          return k ? String(r.src[k]||'') : '';
        })();

        let snippet = '';
        const s1 = highlightSnippet(rawNotes, q);
        const s2 = highlightSnippet(rawItems, q);
        const s3 = highlightSnippet(rawGeneric, q);
        snippet = s1 || s2 || s3;

        return `
          <div class="order-card" role="button" tabindex="0" data-ord="${esc(num)}">
            <div class="badge">${esc(num)}</div>
            <div class="main">
              <div class="name">${esc(r.name)}</div>
              <div class="sub">${pills}</div>
              ${snippet ? `<div class="snippet">${snippet}</div>` : ``}
            </div>
          </div>
        `;
      }).join('');

      // click + tastiera
      out.querySelectorAll('.order-card').forEach((card, idx)=>{
        const ord = card.getAttribute('data-ord');
        const row = hits[idx];
        card.addEventListener('click', ()=>openModal(row, norm(qEl.value)));
        card.addEventListener('keydown', (e)=>{
          if(e.key==='Enter' || e.key===' '){
            e.preventDefault();
            openModal(row, norm(qEl.value));
          }
        });
      });

      status.innerHTML = `Risultati: <b>${hits.length}</b> (modalit√†: <b>${MODE}</b>) ‚Ä¢ <button class="linklike" id="refreshNow2" type="button">aggiorna dati</button>`;
      const btn2 = document.getElementById('refreshNow2');
      if(btn2) btn2.onclick = async ()=>{
        btn2.disabled=true; btn2.textContent='aggiorno‚Ä¶';
        try{ await fetchAPI(); runSearch(); }
        catch(e){ status.textContent = 'Errore aggiornamento: ' + (e.message||e); }
      };
    }

    // ===== Boot =====
    (async function init(){
      try{
        await fetchAPI();
        out.innerHTML = `<div class="empty">Pronto. Ora cerca una parola üëá</div>`;
      }catch(err){
        console.warn(err);
        status.textContent = 'Errore nel caricamento dei dati: ' + (err.message||err);
        out.innerHTML = `<div class="empty">API non raggiungibile o risposta non valida.</div>`;
      }
    })();

  })();
  </script>
</body>
</html>
